var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,s=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&o(e,a,t[a]);return e},c=(e,r)=>t(e,a(r));import{m as d,r as u,R as i,P as m,T as p,I as f,a as E,d as x,b as h,L as g,C as b,c as v,e as w,S as T,f as O,g as S,E as y,D as C,h as k,i as D,j as N,k as I,l as $,n as P,o as L,p as j,q as M,s as J,t as B,u as F,v as U}from"./vendor.d78e75f4.js";const A=d({form:{display:"flex",padding:"0.5em"},input:{flex:"1"},helperText:{position:"absolute",right:"4em",top:0,pointerEvents:"none"}});function R(e){var t=e,{onSubmission:a,children:o,IconButtonProps:c,resetOnSuccess:d=!0}=t,x=((e,t)=>{var a={};for(var o in e)n.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&r)for(var o of r(e))t.indexOf(o)<0&&l.call(e,o)&&(a[o]=e[o]);return a})(t,["onSubmission","children","IconButtonProps","resetOnSuccess"]);const h=A(),[g,b]=u.exports.useState();return i.createElement(m,{component:"form",className:h.form,onSubmit:u.exports.useCallback((async e=>{e.preventDefault();const t=e.target.elements[0];try{await a(t.value),d&&e.target.reset(),b(void 0)}catch(r){b(r.message)}}),[d,a,b])},i.createElement(p,s({error:!!g,helperText:g?i.createElement("span",{className:h.helperText},g):null,className:h.input,InputProps:{endAdornment:i.createElement(f,{position:"end"},i.createElement(E,s({type:"submit"},c),o))}},x)))}function V(e){return i.createElement(R,s({placeholder:"New Todo",required:!0,IconButtonProps:{title:"Add Item"}},e),i.createElement(x,null))}const W=d({wrapper:{display:"inline-flex",verticalAlign:"middle"}});var q=i.memo((function({created:e,updated:t}){const a=W(),r=u.exports.useMemo((()=>e.getTime()!==t.getTime()?`Created  ${e.toLocaleString()}\nUpdated ${t.toLocaleString()}`:e.toLocaleString()),[e,t]);return i.createElement("span",{className:a.wrapper,title:r},i.createElement(h,null))}),((e,t)=>e.created===t.created&&e.updated===t.updated));const z=d({completedText:{'&[data-completed="true"]':{textDecoration:"line-through"}}});var G=i.memo((function({todo:e,onDelete:t,onUpdate:a,onToggle:r}){const n=z(),[l,o]=u.exports.useState(!1),[s,c]=u.exports.useState();u.exports.useEffect((()=>{!l&&s&&c(void 0)}),[l]);const d=u.exports.useCallback((()=>r(e.created)),[r,e.created]),m=u.exports.useMemo((()=>i.createElement(g,null,i.createElement(b,{disabled:!0,checked:!!e.completed,onChange:d,size:"small"}))),[d,e.completed]),f=u.exports.useMemo((()=>i.createElement(q,{created:e.created,updated:e.updated})),[e.created,e.updated]),x=u.exports.useCallback((()=>o(!0)),[o]),h=u.exports.useCallback((()=>o(!1)),[o]),k=u.exports.useCallback((async t=>{t.preventDefault();try{await a(e.created,t.target.elements[1].value),o(!1),c(void 0)}catch(r){c(r.message)}}),[a,c,o]),D=u.exports.useCallback((()=>t(e.created)),[t,e.created]);return l?i.createElement(v,{divider:!0},i.createElement("form",{onSubmit:k},m,i.createElement(p,{autoFocus:!0,error:!!s,helperText:s,placeholder:"Item",defaultValue:e.text}),i.createElement(w,null,i.createElement(E,{type:"submit",title:"Edit"},i.createElement(T,null)),i.createElement(E,{title:"Cancel",onClick:h},i.createElement(O,null)),f))):i.createElement(v,{divider:!0,button:!0,onClick:d},m,i.createElement(S,{classes:{root:n.completedText},"data-completed":!!e.completed},e.text),i.createElement(w,null,i.createElement(E,{title:"Edit",onClick:x,disabled:!!e.completed},i.createElement(y,null)),i.createElement(E,{title:"Delete",onClick:D},i.createElement(C,null)),f))}),((e,t)=>e.todo===t.todo));const H=(e,t,a=JSON.stringify,r=JSON.parse)=>{const[n,l]=u.exports.useState(t);return u.exports.useEffect((()=>l((()=>{const a=localStorage.getItem(e);return null===a?t:r(a)}))),[e]),[n,t=>l((r=>{const n=t instanceof Function?t(r):t;return localStorage.setItem(e,a(n)),n}))]};function K({children:e}){const[t,a]=(e=>{const[t,a]=H("theme",e);return[k({palette:{type:t}}),u.exports.useCallback((()=>a((e=>"dark"===e?"light":"dark"))),[a])]})(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");return i.createElement(D,{theme:t},i.createElement(E,{title:("light"===t.palette.type?"Dark":"Light")+" mode",onClick:a},i.createElement(N,null)),i.createElement(I,null),e)}const Q=d({wrapper:{display:"flex","& > *":{flex:"1"}},label:{display:"flex",alignItems:"center",paddingLeft:"1em"},code:{display:"flex",alignItems:"center"},button:{flex:"0"}});function X({code:e,setCode:t}){const a=Q(),[r,n]=u.exports.useState(!1);return i.createElement(m,{className:a.wrapper},i.createElement($,{component:"h1",className:a.label},"List Code:"),r?i.createElement(R,{IconButtonProps:{title:"Visit List"},defaultValue:e,onSubmission:e=>{t(e),n(!1)},autoFocus:!0},i.createElement(P,null)):i.createElement($,{className:a.code},e),i.createElement(E,{className:a.button,onClick:()=>n((e=>!e))},r?i.createElement(O,null):i.createElement(y,null)))}const Y=e=>e.map((({created:e,updated:t,text:a,completed:r})=>({created:new Date(e),updated:new Date(t),completed:null===r?r:new Date(r),text:a}))),Z="r2-todo-backend.herokuapp.com",_=(e,t)=>fetch(`http://${Z}/api/${e}`,{method:"POST",body:t}).then((e=>e.json())),ee=(e,t)=>fetch(`http://${Z}/api/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())),te=(e,t)=>fetch(`http://${Z}/api/${e}/${t.getTime()}`,{method:"DELETE"}).then((()=>{})),ae=d({wrapper:{position:"absolute",top:"1em",right:"1em"}});function re({code:e,serverOnline:t,realtime:a,realtimeMemberCount:r}){const n=ae();return t?e?a?i.createElement("span",{className:n.wrapper,title:"Realtime"+(r?` - with ${r} others`:"")},i.createElement(J,null)):i.createElement("span",{className:n.wrapper,title:"Synced"},i.createElement(M,null)):i.createElement("span",{className:n.wrapper,title:"On Private List"},i.createElement(j,null)):i.createElement("span",{className:n.wrapper,title:"Server Offline"},i.createElement(L,null))}const ne=(e,t,a)=>[...e.slice(0,t),a,...e.slice(t+1)],le=(e,t)=>[...e.slice(0,t),...e.slice(t+1)],oe=(e,t,a)=>{const[r,n]=H(`todos-${e}`,[],(e=>JSON.stringify((e=>e.map((({created:e,updated:t,text:a,completed:r})=>({created:e.getTime(),updated:t.getTime(),completed:r?r.getTime():null,text:a}))))(e))),(e=>Y(JSON.parse(e)))),l=u.exports.useMemo((()=>!e),[e]),o=((e,t,a,r,n,l)=>{const[o,s]=u.exports.useState(0),c=u.exports.useRef(null);u.exports.useEffect((()=>{if(!t)return;const o=new WebSocket(`ws://${Z}/ws/${e}`,[Date.now().toString()]);return o.addEventListener("open",(()=>{c.current=o,l(!0)})),o.addEventListener("close",(e=>{var t;(null==(t=c.current)?void 0:t.protocol)===e.target.protocol&&(c.current=null,l(!1))})),o.addEventListener("message",(e=>{const[t,l]=JSON.parse(e.data);switch(t){case"create":a(Y([l])[0]);break;case"update":r(Y([l])[0]);break;case"delete":n(new Date(l));break;case"memberCount":s(l);break;case"error":console.error("WS Error:",l)}})),()=>{c.current=null,o.close()}}),[e,t]);const d=(e,t)=>{var a;return null==(a=c.current)?void 0:a.send(JSON.stringify([e,t]))};return{ws:c.current,createTodo:e=>d("create",e),updateTodo:e=>d("update",e),deleteTodo:e=>d("delete",e.getTime()),memberCount:o}})(e,t&&!l,(e=>n((t=>[...t,e]))),(e=>n((t=>ne(t,t.findIndex((t=>t.created.valueOf()===e.created.valueOf())),e)))),(e=>n((t=>le(t,t.findIndex((t=>t.created.valueOf()===e.valueOf())))))),a);u.exports.useEffect((()=>{t&&!l&&(e=>fetch(`http://${Z}/api/${e}`).then((e=>e.json())))(e).then(Y).then(n)}),[l,e,t]);return{todos:r,addTodo:u.exports.useCallback((a=>new Promise(((r,s)=>n((c=>{if(c.find((({text:e})=>e===a)))return s(new Error("TODO already exists")),c;r();const d={created:new Date,updated:new Date,text:a,completed:null};return!t||l?[...c,d]:(o.ws?o.createTodo(a):_(e,a).then((e=>Y([e])[0])).then((e=>n([...c,e]))),c)}))))),[o.ws,l,e,n,t,_]),updateTodo:u.exports.useCallback(((a,r)=>new Promise(((d,u)=>n((i=>{if(i.find((e=>a.valueOf()!==e.created.valueOf()&&e.text===r)))return u(Error("TODO already exists")),i;d();const m=new Date,p=i.findIndex((e=>e.created.valueOf()===a.valueOf())),f=c(s({},i[p]),{updated:m,text:r});return!t||l?ne(i,p,f):(o.ws?o.updateTodo({created:a.getTime(),text:r}):ee(e,{created:a.getTime(),text:r}).then((e=>Y([e])[0])).then((e=>n(ne(i,p,e)))),i)}))))),[o.ws,l,e,n,t,ee]),deleteTodo:u.exports.useCallback((a=>n((r=>{const s=r.findIndex((e=>e.created.valueOf()===a.valueOf()));return!t||l?le(r,s):(o.ws?o.deleteTodo(a):te(e,a).then((()=>n(le(r,s)))),r)}))),[o.ws,l,e,n,t,te]),toggleCompleted:u.exports.useCallback((a=>n((r=>{const d=r.findIndex((e=>e.created.valueOf()===a.valueOf())),u=r[d].completed?null:new Date;return!t||l?ne(r,d,c(s({},r[d]),{completed:u})):(o.ws?o.updateTodo({created:a.getTime(),completed:(null==u?void 0:u.getTime())||null}):ee(e,{created:a.getTime(),completed:(null==u?void 0:u.getTime())||null}).then((e=>Y([e])[0])).then((e=>n(ne(r,d,e)))),r)}))),[o.ws,l,e,n,t,ee]),realtimeMemberCount:o.memberCount}},se=()=>{const[e,t]=u.exports.useState(null);return u.exports.useEffect((()=>{fetch(`http://${Z}/api`).then((e=>e.ok)).then(t)}),[]),e};function ce(){const[e,t]=(()=>{const[e,t]=u.exports.useState(window.location.pathname.split("./").slice(1).join("/"));return[e,e=>t((t=>{const a=e instanceof Function?e(t):e;return history.pushState({},"","./"+a),a}))]})();var a,r;a=e=>"Todos - "+(e?`#${e}`:"Local"),r=[e],u.exports.useEffect((()=>{document.title=a(...r)}),r);const n=se(),[l,o]=u.exports.useState(!1),{todos:s,addTodo:c,updateTodo:d,deleteTodo:m,toggleCompleted:p,realtimeMemberCount:f}=oe(e,!!n,o);return i.createElement(K,null,i.createElement(re,{code:e,serverOnline:!!n,realtime:l,realtimeMemberCount:f}),i.createElement(B,{fixed:!0,maxWidth:"sm"},i.createElement(X,{code:e,setCode:t}),i.createElement(V,{onSubmission:c}),i.createElement(F,null,s.map(((e,t)=>i.createElement(G,{key:t,todo:e,onUpdate:d,onDelete:m,onToggle:p}))))))}U.render(i.createElement(i.StrictMode,null,i.createElement(ce,null)),document.getElementById("root"));
