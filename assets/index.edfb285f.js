var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,c=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&o(e,n,t[n]);if(a)for(var n of a(t))l.call(t,n)&&o(e,n,t[n]);return e},s=(e,a)=>t(e,n(a));import{m as d,r as i,R as u,P as m,T as p,I as f,a as E,d as x,b as h,c as g,L as b,C as v,e as w,f as T,S as O,g as C,h as S,E as k,D as y,u as D,i as N,j as I,k as $,l as P,n as j,o as L,p as M,q as J,s as B,B as F,t as U,v as A,w as R,x as V}from"./vendor.707fee2a.js";const W=d({form:{display:"flex",padding:"0.5em"},input:{flex:"1"},helperText:{position:"absolute",right:"4em",top:0,pointerEvents:"none"}});function q(e){var t=e,{onSubmission:n,children:o,IconButtonProps:s,resetOnSuccess:d=!0}=t,x=((e,t)=>{var n={};for(var o in e)r.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&a)for(var o of a(e))t.indexOf(o)<0&&l.call(e,o)&&(n[o]=e[o]);return n})(t,["onSubmission","children","IconButtonProps","resetOnSuccess"]);const h=W(),[g,b]=i.exports.useState();return u.createElement(m,{component:"form",className:h.form,onSubmit:i.exports.useCallback((async e=>{e.preventDefault();const t=e.target.elements[0];try{await n(t.value),d&&e.target.reset(),b(void 0)}catch(a){b(a.message)}}),[d,n,b])},u.createElement(p,c({error:!!g,helperText:g?u.createElement("span",{className:h.helperText},g):null,className:h.input,InputProps:{endAdornment:u.createElement(f,{position:"end"},u.createElement(E,c({type:"submit"},s),o))}},x)))}function z(e){return u.createElement(q,c({placeholder:"New Todo",required:!0,IconButtonProps:{title:"Add Item"}},e),u.createElement(x,null))}const _=d({wrapper:{display:"inline-flex",verticalAlign:"middle"},tooltipText:{display:"grid",gridTemplateColumns:"auto auto",gap:"0 0.5em"}});var G=u.memo((function({created:e,updated:t,completed:n}){const a=_();return u.createElement(h,{className:a.wrapper,arrow:!0,title:u.createElement("div",{className:a.tooltipText},[["Created",e],["Updated",t],["Completed",n]].filter((([,e])=>e)).map((([e,t],n)=>u.createElement(u.Fragment,{key:n},u.createElement("span",null,e),u.createElement("span",null,t.toLocaleString())))))},u.createElement(g,null))}),((e,t)=>e.created===t.created&&e.updated===t.updated));const H=d({completedText:{'&[data-completed="true"]':{textDecoration:"line-through"}},innerText:{width:"77.5%"}});var K=u.memo((function({todo:e,onDelete:t,onUpdate:n,onToggle:a}){const r=H(),[l,o]=i.exports.useState(!1),[c,s]=i.exports.useState();i.exports.useEffect((()=>{!l&&c&&s(void 0)}),[l]);const d=i.exports.useCallback((()=>a(e.created)),[a,e.created]),m=i.exports.useMemo((()=>u.createElement(b,null,u.createElement(v,{disabled:!0,checked:!!e.completed,onChange:d,size:"small"}))),[d,e.completed]),f=i.exports.useMemo((()=>u.createElement(G,{created:e.created,updated:e.updated,completed:e.completed})),[e.created,e.updated,e.completed]),x=i.exports.useCallback((()=>o(!0)),[o]),h=i.exports.useCallback((()=>o(!1)),[o]),g=i.exports.useCallback((async t=>{t.preventDefault();try{await n(e.created,t.target.elements[1].value),o(!1),s(void 0)}catch(a){s(a.message)}}),[n,s,o]),D=i.exports.useCallback((()=>t(e.created)),[t,e.created]);return l?u.createElement(w,{divider:!0},u.createElement("form",{onSubmit:g},m,u.createElement(p,{autoFocus:!0,error:!!c,helperText:c,placeholder:"Item",defaultValue:e.text}),u.createElement(T,null,u.createElement(E,{type:"submit",title:"Edit"},u.createElement(O,null)),u.createElement(E,{title:"Cancel",onClick:h},u.createElement(C,null)),f))):u.createElement(w,{divider:!0,button:!0,onClick:d},m,u.createElement(S,{classes:{root:r.completedText,primary:r.innerText},"data-completed":!!e.completed},e.text),u.createElement(T,null,u.createElement(E,{title:"Edit",onClick:x,disabled:!!e.completed},u.createElement(k,null)),u.createElement(E,{title:"Delete",onClick:D},u.createElement(y,null)),f))}),((e,t)=>e.todo===t.todo));const Q=(e,t,n=JSON.stringify,a=JSON.parse)=>{const[r,l]=i.exports.useState(t);return i.exports.useEffect((()=>l((()=>{const n=window.localStorage.getItem(e);return null===n?t:a(n)}))),[e]),[r,t=>l((a=>{const r=t instanceof Function?t(a):t;return window.localStorage.setItem(e,n(r)),r}))]};function X({children:e}){const[t,n]=(e=>{const[t,n]=Q("theme",e);return[i.exports.useMemo((()=>N({palette:{type:t}})),[t]),i.exports.useCallback((()=>n((e=>"dark"===e?"light":"dark"))),[n])]})(D("(prefers-color-scheme: dark)")?"dark":"light");return u.createElement(I,{theme:t},u.createElement(E,{title:("light"===t.palette.type?"Dark":"Light")+" mode",onClick:n},u.createElement($,null)),u.createElement(P,null),e)}const Y=d({wrapper:{display:"flex","& > *":{flex:"1"}},label:{display:"flex",alignItems:"center",paddingLeft:"1em"},code:{display:"flex",alignItems:"center"},button:{flex:"0"}});function Z({code:e,setCode:t}){const n=Y(),[a,r]=i.exports.useState(!1);return u.createElement(m,{className:n.wrapper},u.createElement(j,{component:"h1",className:n.label},"List Code:"),a?u.createElement(q,{IconButtonProps:{title:"Visit List"},defaultValue:e,onSubmission:e=>{t(e),r(!1)},autoFocus:!0},u.createElement(L,null)):u.createElement(j,{className:n.code},e),u.createElement(E,{className:n.button,onClick:()=>r((e=>!e)),title:a?"Cancel":"Edit List Code"},a?u.createElement(C,null):u.createElement(k,null)))}const ee=e=>e.map((({created:e,updated:t,text:n,completed:a})=>({created:new Date(e),updated:null===t?t:new Date(t),completed:null===a?a:new Date(a),text:n}))),te="r2-todo-fullstack.herokuapp.com",ne=window.location.protocol.includes("https"),ae=`${window.location.protocol}//${te}`,re=()=>fetch(`${ae}/api`,{credentials:"include"}).then((e=>e.ok)).catch((()=>!1)),le=(e,t)=>fetch(`${ae}/api/${e}`,{credentials:"include",method:"POST",body:t}).then((e=>e.json())),oe=(e,t)=>fetch(`${ae}/api/${e}`,{credentials:"include",method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())),ce=(e,t)=>fetch(`${ae}/api/${e}/${t.getTime()}`,{credentials:"include",method:"DELETE"}).then((()=>{})),se=d({wrapper:{position:"absolute",top:"1em",right:"1em"}});function de({code:e,serverOnline:t,realtime:n,realtimeMemberCount:a}){const r=se();if(!t)return u.createElement("span",{className:r.wrapper,title:"Server Offline"},u.createElement(M,null));if(!e)return u.createElement("span",{className:r.wrapper,title:"On Private List"},u.createElement(J,null));if(!n)return u.createElement("span",{className:r.wrapper,title:"Synced"},u.createElement(B,null));const l=a-1;return u.createElement(F,{className:r.wrapper,title:"Realtime"+(l?` - with ${l} other${l>1?"s":""}`:""),badgeContent:l},u.createElement(U,null))}const ie=(e,t,n)=>[...e.slice(0,t),n,...e.slice(t+1)],ue=(e,t)=>[...e.slice(0,t),...e.slice(t+1)],me=(e,t,n,a)=>{const[r,l]=Q(`todos-${e}`,[],(e=>JSON.stringify((e=>e.map((({created:e,updated:t,text:n,completed:a})=>({created:e.getTime(),updated:t?t.getTime():null,completed:a?a.getTime():null,text:n}))))(e))),(e=>ee(JSON.parse(e)))),[o,d]=i.exports.useState(""),u=i.exports.useMemo((()=>!e),[e]),m=((e,t,n,a,r,l,o)=>{const[c,s]=i.exports.useState(-1),d=i.exports.useRef(null);i.exports.useEffect((()=>{if(!n||!t)return;const c=new WebSocket(`ws${ne?"s":""}://${te}/ws/${e}`,[Date.now().toString(),t]);return c.addEventListener("open",(()=>{d.current=c,o(!0),s(0)})),c.addEventListener("close",(e=>{var t;(null==(t=d.current)?void 0:t.protocol)===e.target.protocol&&(d.current=null,o(!1),s(-1))})),c.addEventListener("message",(e=>{const[t,n]=JSON.parse(e.data);switch(t){case"create":a(ee([n])[0]);break;case"update":r(ee([n])[0]);break;case"delete":l(new Date(n));break;case"memberCount":s(n);break;case"error":console.error("WS Error:",n)}})),()=>{d.current=null,c.close()}}),[e,n,t]);const u=(e,t)=>{var n;return null==(n=d.current)?void 0:n.send(JSON.stringify([e,t]))};return{connected:-1!==c,createTodo:e=>u("create",e),updateTodo:e=>u("update",e),deleteTodo:e=>u("delete",e.getTime()),memberCount:c}})(e,o,t&&!u,(e=>l((t=>[...t,e]))),(e=>l((t=>ie(t,t.findIndex((t=>t.created.valueOf()===e.created.valueOf())),e)))),(e=>l((t=>ue(t,t.findIndex((t=>t.created.valueOf()===e.valueOf())))))),a),p=i.exports.useCallback((()=>u?Promise.resolve(!1):m.connected?Promise.resolve(!0):n()),[u,m.connected]);i.exports.useEffect((()=>{t&&!u&&(e=>fetch(`${ae}/api/${e}`,{credentials:"include"}).then((e=>e.json())))(e).then((({csrf_token:e,todos:t})=>(d(e),ee(t)))).then(l)}),[u,e,t]);return{todos:r,addTodo:i.exports.useCallback((t=>new Promise(((n,a)=>p().then((r=>l((o=>{if(o.find((({text:e})=>e===t)))return a(new Error("TODO already exists")),o;n();const c={created:new Date,updated:new Date,text:t,completed:null};return!r||u?[...o,c]:(m.connected?m.createTodo(t):le(e,t).then((e=>ee([e])[0])).then((e=>l([...o,e]))),o)}))))))),[m.connected,u,e,l,le]),updateTodo:i.exports.useCallback(((t,n)=>new Promise(((a,r)=>p().then((o=>l((d=>{if(d.find((e=>t.valueOf()!==e.created.valueOf()&&e.text===n)))return r(Error("TODO already exists")),d;a();const i=new Date,p=d.findIndex((e=>e.created.valueOf()===t.valueOf())),f=s(c({},d[p]),{updated:i,text:n});return!o||u?ie(d,p,f):(m.connected?m.updateTodo({created:t.getTime(),text:n}):oe(e,{created:t.getTime(),text:n}).then((e=>ee([e])[0])).then((e=>l(ie(d,p,e)))),d)}))))))),[m.connected,u,e,l,oe]),deleteTodo:i.exports.useCallback((t=>p().then((n=>l((a=>{const r=a.findIndex((e=>e.created.valueOf()===t.valueOf()));return!n||u?ue(a,r):(m.connected?m.deleteTodo(t):ce(e,t).then((()=>l(ue(a,r)))),a)}))))),[m.connected,u,e,l,ce]),toggleCompleted:i.exports.useCallback((t=>p().then((n=>l((a=>{const r=a.findIndex((e=>e.created.valueOf()===t.valueOf())),o=a[r].completed?null:new Date;return!n||u?ie(a,r,s(c({},a[r]),{completed:o})):(m.connected?m.updateTodo({created:t.getTime(),completed:(null==o?void 0:o.getTime())||null}):oe(e,{created:t.getTime(),completed:(null==o?void 0:o.getTime())||null}).then((e=>ee([e])[0])).then((e=>l(ie(a,r,e)))),a)}))))),[m.connected,u,e,l,oe]),realtimeMemberCount:m.memberCount}};function pe(){const[e,t]=(()=>{const[e,t]=i.exports.useState(window.location.pathname.includes("./")?window.location.pathname.split("./").slice(1).join("/"):window.location.pathname.slice(1));return[e,e=>t((t=>{const n=e instanceof Function?e(t):e;return window.history.pushState({},"","./"+n),n}))]})();var n,a;n=e=>"Todos - "+(e?`#${e}`:"Local"),a=[e],i.exports.useEffect((()=>{document.title=n(...a)}),a);const[r,l]=(()=>{const[e,t]=i.exports.useState(null);return i.exports.useEffect((()=>{re().then(t)}),[]),[e,i.exports.useCallback((()=>re().then((e=>(t(e),e)))),[])]})(),[o,c]=i.exports.useState(!1),{todos:s,addTodo:d,updateTodo:m,deleteTodo:p,toggleCompleted:f,realtimeMemberCount:E}=me(e,!!r,l,c);return u.createElement(X,null,u.createElement(de,{code:e,serverOnline:!!r,realtime:o,realtimeMemberCount:E}),u.createElement(A,{fixed:!0,maxWidth:"sm"},u.createElement(Z,{code:e,setCode:t}),u.createElement(z,{onSubmission:d}),u.createElement(R,null,s.map((e=>u.createElement(K,{key:e.created.valueOf(),todo:e,onUpdate:m,onDelete:p,onToggle:f}))))))}V.render(u.createElement(u.StrictMode,null,u.createElement(pe,null)),document.getElementById("root"));
