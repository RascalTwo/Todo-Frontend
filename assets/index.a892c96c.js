var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,s=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&o(e,n,t[n]);if(a)for(var n of a(t))l.call(t,n)&&o(e,n,t[n]);return e},c=(e,a)=>t(e,n(a));import{m as d,r as u,R as i,P as m,T as p,I as f,a as E,d as x,b as h,L as g,C as b,c as v,e as w,S as T,f as O,g as S,E as y,D as C,h as k,i as D,j as N,k as I,l as $,n as P,o as L,p as j,q as M,s as J,t as F,u as B,v as U}from"./vendor.7c859f17.js";const A=d({form:{display:"flex",padding:"0.5em"},input:{flex:"1"},helperText:{position:"absolute",right:"4em",top:0,pointerEvents:"none"}});function R(e){var t=e,{onSubmission:n,children:o,IconButtonProps:c,resetOnSuccess:d=!0}=t,x=((e,t)=>{var n={};for(var o in e)r.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&a)for(var o of a(e))t.indexOf(o)<0&&l.call(e,o)&&(n[o]=e[o]);return n})(t,["onSubmission","children","IconButtonProps","resetOnSuccess"]);const h=A(),[g,b]=u.exports.useState();return i.createElement(m,{component:"form",className:h.form,onSubmit:u.exports.useCallback((async e=>{e.preventDefault();const t=e.target.elements[0];try{await n(t.value),d&&e.target.reset(),b(void 0)}catch(a){b(a.message)}}),[d,n,b])},i.createElement(p,s({error:!!g,helperText:g?i.createElement("span",{className:h.helperText},g):null,className:h.input,InputProps:{endAdornment:i.createElement(f,{position:"end"},i.createElement(E,s({type:"submit"},c),o))}},x)))}function V(e){return i.createElement(R,s({placeholder:"New Todo",required:!0,IconButtonProps:{title:"Add Item"}},e),i.createElement(x,null))}const W=d({wrapper:{display:"inline-flex",verticalAlign:"middle"}});var q=i.memo((function({created:e,updated:t}){const n=W(),a=u.exports.useMemo((()=>e.getTime()!==t.getTime()?`Created  ${e.toLocaleString()}\nUpdated ${t.toLocaleString()}`:e.toLocaleString()),[e,t]);return i.createElement("span",{className:n.wrapper,title:a},i.createElement(h,null))}),((e,t)=>e.created===t.created&&e.updated===t.updated));const z=d({completedText:{'&[data-completed="true"]':{textDecoration:"line-through"}}});var G=i.memo((function({todo:e,onDelete:t,onUpdate:n,onToggle:a}){const r=z(),[l,o]=u.exports.useState(!1),[s,c]=u.exports.useState();u.exports.useEffect((()=>{!l&&s&&c(void 0)}),[l]);const d=u.exports.useCallback((()=>a(e.created)),[a,e.created]),m=u.exports.useMemo((()=>i.createElement(g,null,i.createElement(b,{disabled:!0,checked:!!e.completed,onChange:d,size:"small"}))),[d,e.completed]),f=u.exports.useMemo((()=>i.createElement(q,{created:e.created,updated:e.updated})),[e.created,e.updated]),x=u.exports.useCallback((()=>o(!0)),[o]),h=u.exports.useCallback((()=>o(!1)),[o]),k=u.exports.useCallback((async t=>{t.preventDefault();try{await n(e.created,t.target.elements[1].value),o(!1),c(void 0)}catch(a){c(a.message)}}),[n,c,o]),D=u.exports.useCallback((()=>t(e.created)),[t,e.created]);return l?i.createElement(v,{divider:!0},i.createElement("form",{onSubmit:k},m,i.createElement(p,{autoFocus:!0,error:!!s,helperText:s,placeholder:"Item",defaultValue:e.text}),i.createElement(w,null,i.createElement(E,{type:"submit",title:"Edit"},i.createElement(T,null)),i.createElement(E,{title:"Cancel",onClick:h},i.createElement(O,null)),f))):i.createElement(v,{divider:!0,button:!0,onClick:d},m,i.createElement(S,{classes:{root:r.completedText},"data-completed":!!e.completed},e.text),i.createElement(w,null,i.createElement(E,{title:"Edit",onClick:x,disabled:!!e.completed},i.createElement(y,null)),i.createElement(E,{title:"Delete",onClick:D},i.createElement(C,null)),f))}),((e,t)=>e.todo===t.todo));const H=(e,t,n=JSON.stringify,a=JSON.parse)=>{const[r,l]=u.exports.useState(t);return u.exports.useEffect((()=>l((()=>{const n=localStorage.getItem(e);return null===n?t:a(n)}))),[e]),[r,t=>l((a=>{const r=t instanceof Function?t(a):t;return localStorage.setItem(e,n(r)),r}))]};function K({children:e}){const[t,n]=(e=>{const[t,n]=H("theme",e);return[k({palette:{type:t}}),u.exports.useCallback((()=>n((e=>"dark"===e?"light":"dark"))),[n])]})(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");return i.createElement(D,{theme:t},i.createElement(E,{title:("light"===t.palette.type?"Dark":"Light")+" mode",onClick:n},i.createElement(N,null)),i.createElement(I,null),e)}const Q=d({wrapper:{display:"flex","& > *":{flex:"1"}},label:{display:"flex",alignItems:"center",paddingLeft:"1em"},code:{display:"flex",alignItems:"center"},button:{flex:"0"}});function X({code:e,setCode:t}){const n=Q(),[a,r]=u.exports.useState(!1);return i.createElement(m,{className:n.wrapper},i.createElement($,{component:"h1",className:n.label},"List Code:"),a?i.createElement(R,{IconButtonProps:{title:"Visit List"},defaultValue:e,onSubmission:e=>{t(e),r(!1)},autoFocus:!0},i.createElement(P,null)):i.createElement($,{className:n.code},e),i.createElement(E,{className:n.button,onClick:()=>r((e=>!e))},a?i.createElement(O,null):i.createElement(y,null)))}const Y=e=>e.map((({created:e,updated:t,text:n,completed:a})=>({created:new Date(e),updated:new Date(t),completed:null===a?a:new Date(a),text:n}))),Z=window.location.host,_=(e,t)=>fetch(`http://${Z}/api/${e}`,{method:"POST",body:t}).then((e=>e.json())),ee=(e,t)=>fetch(`http://${Z}/api/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())),te=(e,t)=>fetch(`http://${Z}/api/${e}/${t.getTime()}`,{method:"DELETE"}).then((()=>{})),ne=d({wrapper:{position:"absolute",top:"1em",right:"1em"}});function ae({code:e,serverOnline:t,realtime:n,realtimeMemberCount:a}){const r=ne();return t?e?n?i.createElement("span",{className:r.wrapper,title:"Realtime"+(a?` - with ${a} others`:"")},i.createElement(J,null)):i.createElement("span",{className:r.wrapper,title:"Synced"},i.createElement(M,null)):i.createElement("span",{className:r.wrapper,title:"On Private List"},i.createElement(j,null)):i.createElement("span",{className:r.wrapper,title:"Server Offline"},i.createElement(L,null))}const re=(e,t,n)=>[...e.slice(0,t),n,...e.slice(t+1)],le=(e,t)=>[...e.slice(0,t),...e.slice(t+1)],oe=(e,t,n)=>{const[a,r]=H(`todos-${e}`,[],(e=>JSON.stringify((e=>e.map((({created:e,updated:t,text:n,completed:a})=>({created:e.getTime(),updated:t.getTime(),completed:a?a.getTime():null,text:n}))))(e))),(e=>Y(JSON.parse(e)))),l=u.exports.useMemo((()=>!e),[e]),o=((e,t,n,a,r,l)=>{const[o,s]=u.exports.useState(0),c=u.exports.useRef(null);u.exports.useEffect((()=>{if(!t)return;const o=new WebSocket(`ws://${Z}/ws/${e}`,[Date.now().toString()]);return o.addEventListener("open",(()=>{c.current=o,l(!0)})),o.addEventListener("close",(e=>{var t;(null==(t=c.current)?void 0:t.protocol)===e.target.protocol&&(c.current=null,l(!1))})),o.addEventListener("message",(e=>{const[t,l]=JSON.parse(e.data);switch(t){case"create":n(Y([l])[0]);break;case"update":a(Y([l])[0]);break;case"delete":r(new Date(l));break;case"memberCount":s(l);break;case"error":console.error("WS Error:",l)}})),()=>{c.current=null,o.close()}}),[e,t]);const d=(e,t)=>{var n;return null==(n=c.current)?void 0:n.send(JSON.stringify([e,t]))};return{ws:c.current,createTodo:e=>d("create",e),updateTodo:e=>d("update",e),deleteTodo:e=>d("delete",e.getTime()),memberCount:o}})(e,t&&!l,(e=>r((t=>[...t,e]))),(e=>r((t=>re(t,t.findIndex((t=>t.created.valueOf()===e.created.valueOf())),e)))),(e=>r((t=>le(t,t.findIndex((t=>t.created.valueOf()===e.valueOf())))))),n);u.exports.useEffect((()=>{t&&!l&&(e=>fetch(`http://${Z}/api/${e}`).then((e=>e.json())))(e).then(Y).then(r)}),[l,e,t]);return{todos:a,addTodo:u.exports.useCallback((n=>new Promise(((a,s)=>r((c=>{if(c.find((({text:e})=>e===n)))return s(new Error("TODO already exists")),c;a();const d={created:new Date,updated:new Date,text:n,completed:null};return!t||l?[...c,d]:(o.ws?o.createTodo(n):_(e,n).then((e=>Y([e])[0])).then((e=>r([...c,e]))),c)}))))),[o.ws,l,e,r,t,_]),updateTodo:u.exports.useCallback(((n,a)=>new Promise(((d,u)=>r((i=>{if(i.find((e=>n.valueOf()!==e.created.valueOf()&&e.text===a)))return u(Error("TODO already exists")),i;d();const m=new Date,p=i.findIndex((e=>e.created.valueOf()===n.valueOf())),f=c(s({},i[p]),{updated:m,text:a});return!t||l?re(i,p,f):(o.ws?o.updateTodo({created:n.getTime(),text:a}):ee(e,{created:n.getTime(),text:a}).then((e=>Y([e])[0])).then((e=>r(re(i,p,e)))),i)}))))),[o.ws,l,e,r,t,ee]),deleteTodo:u.exports.useCallback((n=>r((a=>{const s=a.findIndex((e=>e.created.valueOf()===n.valueOf()));return!t||l?le(a,s):(o.ws?o.deleteTodo(n):te(e,n).then((()=>r(le(a,s)))),a)}))),[o.ws,l,e,r,t,te]),toggleCompleted:u.exports.useCallback((n=>r((a=>{const d=a.findIndex((e=>e.created.valueOf()===n.valueOf())),u=a[d].completed?null:new Date;return!t||l?re(a,d,c(s({},a[d]),{completed:u})):(o.ws?o.updateTodo({created:n.getTime(),completed:(null==u?void 0:u.getTime())||null}):ee(e,{created:n.getTime(),completed:(null==u?void 0:u.getTime())||null}).then((e=>Y([e])[0])).then((e=>r(re(a,d,e)))),a)}))),[o.ws,l,e,r,t,ee]),realtimeMemberCount:o.memberCount}},se=()=>{const[e,t]=u.exports.useState(null);return u.exports.useEffect((()=>{fetch(`http://${Z}/api`).then((e=>e.ok)).then(t)}),[]),e};function ce(){const[e,t]=(()=>{const[e,t]=u.exports.useState(window.location.pathname.split("/Todo-Frontend/").slice(1).join("/"));return[e,e=>t((t=>{const n=e instanceof Function?e(t):e;return history.pushState({},"","/Todo-Frontend/"+n),n}))]})();var n,a;n=e=>"Todos - "+(e?`#${e}`:"Local"),a=[e],u.exports.useEffect((()=>{document.title=n(...a)}),a);const r=se(),[l,o]=u.exports.useState(!1),{todos:s,addTodo:c,updateTodo:d,deleteTodo:m,toggleCompleted:p,realtimeMemberCount:f}=oe(e,!!r,o);return i.createElement(K,null,i.createElement(ae,{code:e,serverOnline:!!r,realtime:l,realtimeMemberCount:f}),i.createElement(F,{fixed:!0,maxWidth:"sm"},i.createElement(X,{code:e,setCode:t}),i.createElement(V,{onSubmission:c}),i.createElement(B,null,s.map(((e,t)=>i.createElement(G,{key:t,todo:e,onUpdate:d,onDelete:m,onToggle:p}))))))}U.render(i.createElement(i.StrictMode,null,i.createElement(ce,null)),document.getElementById("root"));
